let id = Math.ceil(Math.random() * 10)

export const uid = () => id++
export const getType = value => Object.prototype.toString.call(value).slice(8, -1)

let data = [
  {
    "_id": "53f0fede4b36e5a82b99faa0",
    "index": 0,
    "guid": "398dc164-57e1-4bad-896b-5cd7bba3629b",
    "isActive": true,
    "balance": null,
    "picture": "http://placehold.it/32x32",
    "age": 34,
    "eyeColor": "green",
    "name": "Floyd Owens",
    "gender": "male",
    "company": "EVENTIX",
    "email": "floydowens@eventix.com",
    "phone": "+1 (967) 596-3085",
    "address": "575 Colonial Road, Rose, New Jersey, 9664",
    "about": "Voluptate est cupidatat dolore eiusmod est qui voluptate aliqua sunt aute consequat irure aliquip occaecat. Ea sit esse aute officia incididunt commodo non aute consequat fugiat incididunt. Enim deserunt laborum veniam minim esse duis exercitation sit elit tempor ex ut duis labore. Occaecat commodo fugiat sint est anim cupidatat ex consequat pariatur consectetur non excepteur aliquip laborum. Sit ipsum eiusmod magna tempor enim incididunt. Consectetur do dolor Lorem ad. Est ea fugiat fugiat nulla eu velit est.\r\n",
    "registered": "2014-04-22T13:50:16 +04:00",
    "latitude": 49.662087,
    "longitude": -161.956888,
    "tags": [
      "sit",
      "dolor",
      "amet",
      "dolor",
      "consectetur",
      "eiusmod",
      "fugiat"
    ],
    "friends": [
      {
        "id": 0,
        "name": "Katrina Livingston"
      },
      {
        "id": 1,
        "name": "Lucile Reilly"
      },
      {
        "id": 2,
        "name": "Marion Pena"
      }
    ],
    "thingebopper": {
      "facets": [
        "elit in",
        "ad deserunt",
        "irure amet",
        "amet dolore",
        "consequat incididunt",
        "esse quis",
        "aute esse",
        "officia irure",
        "pariatur eiusmod",
        "non ullamco",
        "ut anim",
        "duis do",
        "incididunt aute",
        "exercitation nostrud",
        "pariatur occaecat",
        "qui ea",
        "Lorem aliqua",
        "nostrud amet",
        "laboris pariatur",
        "voluptate adipisicing",
        "adipisicing mollit",
        "cupidatat ad",
        "fugiat commodo",
        "nulla commodo",
        "incididunt sit",
        "enim aute",
        "exercitation dolore",
        "occaecat quis",
        "commodo Lorem",
        "culpa est",
        "nulla esse",
        "ullamco aliquip",
        "minim Lorem",
        "consequat eu"
      ],
      "misc": {
        "val": 1838,
        "alert": false,
        "petName": "Sara",
        "favoriteFood": "granola"
      }
    },
    "greeting": "Hello, Floyd Owens! You have 2 unread messages."
  },
  {
    "_id": "53f0fede54422ca2ca382c2f",
    "index": 1,
    "guid": "bfb4cdaa-028f-4f8c-afae-3dbf814f897d",
    "isActive": false,
    "balance": "$2,620.93",
    "picture": "http://placehold.it/32x32",
    "age": 39,
    "eyeColor": "brown",
    "name": "Concetta Battle",
    "gender": "female",
    "company": "GUSHKOOL",
    "email": "concettabattle@gushkool.com",
    "phone": "+1 (813) 476-2353",
    "address": "853 Metrotech Courtr, Dodge, Pennsylvania, 274",
    "about": "Irure laboris reprehenderit veniam dolor qui. Incididunt nisi cillum anim anim pariatur ad veniam veniam ea amet officia. In aute do tempor ut eu culpa eu voluptate. Magna culpa sint sunt labore labore dolore magna minim reprehenderit et voluptate officia id. Nisi laborum nostrud sunt qui id. Aute irure aute aliquip mollit in nostrud esse commodo elit esse nulla tempor qui. Do eiusmod et excepteur eiusmod labore ut tempor officia ex in excepteur.\r\n",
    "registered": "2014-07-02T19:55:27 +04:00",
    "latitude": 19.246843,
    "longitude": -20.993529,
    "tags": [
      "ad",
      "ipsum",
      "duis",
      "irure",
      "ea",
      "est",
      "reprehenderit"
    ],
    "friends": [
      {
        "id": 0,
        "name": "Callie Anthony"
      },
      {
        "id": 1,
        "name": "Becker Head"
      },
      {
        "id": 2,
        "name": "Karla Poole"
      }
    ],
    "thingebopper": {
      "facets": [
        "excepteur ullamco",
        "laborum incididunt",
        "cupidatat culpa",
        "cillum aute",
        "ut reprehenderit",
        "eu laborum",
        "enim culpa",
        "do mollit",
        "anim sunt",
        "eu nostrud",
        "dolor cillum",
        "sit non",
        "esse sunt",
        "id ut",
        "duis veniam",
        "magna consectetur",
        "sint eiusmod",
        "esse sit",
        "ex amet",
        "Lorem consectetur",
        "ut est",
        "proident qui",
        "aliqua dolore",
        "duis quis",
        "exercitation amet",
        "et exercitation",
        "anim ipsum",
        "mollit dolore",
        "magna minim",
        "nostrud ullamco",
        "adipisicing dolor",
        "cupidatat ipsum",
        "non mollit",
        "sunt cupidatat"
      ],
      "misc": {
        "val": 1427,
        "alert": true,
        "petName": "Willie",
        "favoriteFood": "granola"
      }
    },
    "greeting": "Hello, Concetta Battle! You have 9 unread messages.",
    "favoriteFruit": "banana"
  },
  {
    "_id": "53f0fede9620d8c0d14b722f",
    "index": 2,
    "guid": "dc7a3a81-cf6f-4708-90e3-2d0bfebd272d",
    "isActive": true,
    "balance": "$1,279.15",
    "picture": "http://placehold.it/32x32",
    "age": 28,
    "eyeColor": "green",
    "name": "Janette Smith",
    "gender": "female",
    "company": "INTERFIND",
    "email": "janettesmith@interfind.com",
    "phone": "+1 (830) 574-2164",
    "address": "382 Boardwalk , Imperial, West Virginia, 4061",
    "about": "Commodo ex est laborum ipsum proident sint sint. Ad ipsum officia consequat veniam qui exercitation quis elit cupidatat cillum esse laboris. Anim commodo occaecat consequat magna elit deserunt dolore. Reprehenderit ullamco ullamco nisi ad ipsum eu labore aute occaecat. Exercitation sint culpa minim ex irure veniam ad do. Occaecat aliqua cupidatat veniam minim veniam exercitation ipsum pariatur.\r\n",
    "registered": "2014-07-01T21:35:25 +04:00",
    "latitude": -44.038184,
    "longitude": -158.336297,
    "tags": [
      "fugiat",
      "voluptate",
      "eu",
      "voluptate",
      "et",
      "duis",
      "elit"
    ],
    "friends": [
      {
        "id": 0,
        "name": "Claudette Donovan"
      },
      {
        "id": 1,
        "name": "Mara Singleton"
      },
      {
        "id": 2,
        "name": "Kidd Perry"
      }
    ],
    "thingebopper": {
      "facets": [
        "fugiat aute",
        "eu non",
        "tempor sunt",
        "quis do",
        "incididunt commodo",
        "non do",
        "culpa sint",
        "et aute",
        "culpa nostrud",
        "anim deserunt",
        "laborum adipisicing",
        "elit id",
        "do pariatur",
        "proident cillum",
        "commodo do",
        "sunt enim",
        "esse tempor",
        "veniam eu",
        "consequat occaecat",
        "tempor eu",
        "eiusmod minim",
        "nostrud veniam",
        "dolore aliqua",
        "laboris adipisicing",
        "excepteur aliqua",
        "do ipsum",
        "elit nostrud",
        "dolore aliqua",
        "in et",
        "sint adipisicing",
        "mollit aliqua",
        "officia proident",
        "nisi dolore",
        "sit occaecat"
      ],
      "misc": {
        "val": 3353,
        "alert": false,
        "petName": "Schmidt",
        "favoriteFood": "bacon"
      }
    },
    "greeting": "Hello, Janette Smith! You have 8 unread messages.",
    "favoriteFruit": "apple"
  }
]

view Main {
  <link rel="stylesheet" property="stylesheet" href="__/static/tools.css" />
  <Errors />
  <Installer />
  <State />

  <Inspector if={__isDevingDevTools} data={data} isExpanded={true} />
  <Test if={__isDevingDevTools} />

  $ = {
    position: 'fixed',
    pointerEvents: 'none',
    top: 0, left: 0,
    right: 0, bottom: 0,
    zIndex: 2147483647
  }
}

view Test {
  let num = 0
  let str = 'hello'
  let obj = {
    one: 'two',
    three: 4
  }

  <h1>
    inspect me
  </h1>

  $ = {
    pointerEvents: 'all'
  }
}


var assign = Object.assign
var keys = Object.keys

export function createFilterer(data, options) {
    options || (options = {});
    var cache = {};

    return function(query) {
        var subquery;

        if (!cache[query]) {
            for (var i = query.length - 1; i > 0; i -= 1) {
                subquery = query.substr(0, i);

                if (cache[subquery]) {
                    cache[query] = find(cache[subquery], query, options);
                    break;
                }
            }
        }

        if (!cache[query]) {
            cache[query] = find(data, query, options);
        }

        return cache[query];
    };
};

function find(data, query, options) {
    return keys(data).reduce(function(acc, key) {
        var value = data[key];
        var matches;

        if (isPrimitive(value)) {
            if (contains(query, key, options) || contains(query, value, options)) {
                acc[key] = value;
            }
        } else {
            if (contains(query, key, options)) {
                acc[key] = value;
            } else {
                matches = find(value, query, options);

                if (!isEmpty(matches)) {
                    assign(acc, pair(key, matches));
                }
            }
        }

        return acc;
    }, {});
}

function contains(query, string, options) {
  if(options.ignoreCase) {
    query = String(query).toLowerCase();
    return string && String(string).toLowerCase().indexOf(query) !== -1;
  } else {
    return string && String(string).indexOf(query) !== -1;
  }
}

function isPrimitive(value) {
  var t = getType(value);
  return t !== 'Object' && t !== 'Array';
}

function pair(key, value) {
  var p = {};
  p[key] = value;
  return p;
}





const PATH_DELIMITER = '.'

export function lens(data, path) {
    var p = path.split(PATH_DELIMITER);
    var segment = p.shift();

    if (!segment) {
        return data;
    }

    var t = getType(data);

    if (t === 'Array' && data[integer(segment)]) {
        return lens(data[integer(segment)], p.join(PATH_DELIMITER));
    } else if (t === 'Object' && data[segment]) {
        return lens(data[segment], p.join(PATH_DELIMITER));
    }
}

function integer(string) {
    return parseInt(string, 10);
}